name: Deploy Notebook Quartz Page
 
on:
  push:
    branches:
      - main
  workflow_dispatch:

permissions:
  contents: write
 
jobs:
  deploy:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout Quartz Repository
        uses: actions/checkout@v6
        with:
          path: quartz
 
      - name: Checkout Notebook Repository
        uses: actions/checkout@v6
        with:
          repository: 0xE29DA4/notebook
          path: notebook

      - name: Copy Notebook Content to Quartz Content Directory
        run: |
          mkdir -p quartz/content
          cp -r notebook/* quartz/content/
          cp quartz/CNAME quartz/public/CNAME || true
 
      - name: Setup Node.js
        uses: actions/setup-node@v6
        with:
          node-version: 22
 
      - name: Install Quartz Dependencies
        run: |
          cd quartz
          npm install
 
      - name: Build Quartz Site
        run: |
          cd quartz
          npx quartz build
 
      - name: Deploy to GitHub Pages
        uses: peaceiris/actions-gh-pages@v4
        with:
          github_token: ${{ secrets.GITHUB_TOKEN }}
          publish_dir: ./quartz/public
          publish_branch: gh-pages

